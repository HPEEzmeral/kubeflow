apiVersion: batch/v1
kind: Job
metadata:
  name: dex-cm-generator
  namespace: kubeflow-operator
spec:
  template:
    spec:
      serviceAccountName: kubeflow-operator
      containers:
        - name: script
          image: bitnami/kubectl:latest
          imagePullPolicy: IfNotPresent
          command: ["/bin/bash"]
          args:
            - "/mnt/dex-cm-generator/entrypoint.sh"
          volumeMounts:
            - mountPath: /mnt/dex-cm-generator
              name: dex-cm-generator
          env:
            - name: AUTH_SECRET_NAME
              value: "$(AUTH_SECRET_NAME-env)"
            - name: AUTH_SECRET_NAMESPACE
              value: "$(AUTH_SECRET_NAMESPACE-env)"
      volumes:
        - name: dex-cm-generator
          configMap:
            name: dex-cm-generator
      restartPolicy: Never
